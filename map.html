<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Perth Map</title>

    <link href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet" type="text/css" />

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">


    <!-- Latest compiled and minified JQuery -->
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.min.js"></script>
    <!-- Latest compiled and minified Bootstrap JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <script src="https://maps.googleapis.com/maps/api/js?libraries=places,geometry&key=AIzaSyA7xY6JgrR-hAOLs1ZmZU9vCoFNb_YQ7qI"></script>

    <script src="Perth.js"></script>

    <script src="Perth_JSON.js"></script>

    <script type="text/javascript">
        var aLocations;
        var marker = [];
        var map;
        var mapOptions = {
            zoom: 13,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            center: new google.maps.LatLng(-31.9505, 115.8605)
        };
        var polyArray = [];
        function initialize() {
            map = new google.maps.Map(document.getElementById("map_canvas"),
                    mapOptions);
            var auto_options = {
                types: ['geocode']
                //componentRestrictions: {country: "us"}
            };

            var address_bar = (document.getElementById('address_bar'));
            var address = (document.getElementById('address'));
            var autocomplete = new google.maps.places.Autocomplete(address);

            google.maps.event.addListener(autocomplete, 'place_changed', function() {
                var place = autocomplete.getPlace();
                if (!place.geometry) {
                    return;
                }
                map.setCenter(place.geometry.location);
                map.setZoom(14);
            });

            map.controls[google.maps.ControlPosition.LEFT_TOP].push(address_bar);
            getGeoJSON();
        }

        function getGeoJSON() {
            var poly = perth.features;
            var style = perth_json.kml.Document.Style;
            var placeMarks = perth_json.kml.Document.Folder.Placemark;
            for(var i in poly) {
                var coordinates = poly[i].geometry.coordinates[0];
                var polyStyle = placeMarks[i].styleUrl.replace("#", "");
                polyStyle += "-normal";
                var lineColor = "";
                var polyColor = "";
                for(var i in style) {
                    if(style[i]["-id"] == polyStyle) {
                        lineColor = style[i].LineStyle.color;
                        polyColor = style[i].PolyStyle.color;
                    }
                }
                var poly_path = [];
                for(var i in coordinates) {
                    var crd = new google.maps.LatLng(coordinates[i][0], coordinates[i][1]);
                    poly_path.push(crd);
                }
                if(i == 0) {
                    polyArray[i] = new google.maps.Polygon({
                        paths: poly_path,
                        strokeColor: '#'+lineColor,
                        strokeOpacity: 0.8,
                        strokeWeight: 1,
                        fillColor: '#'+polyColor,
                        fillOpacity: 0.35
                    });
                    polyArray[i].setMap(map);
                }
            }
        }

        google.maps.event.addDomListener(window, 'load', initialize);
    </script>
</head>
<body>
<div class="input-group col-md-4" id="address_bar">
    <input type="text" class="form-control" style="margin-left: 20px" id="address" name="address" placeholder="Search Address" />
</div>
<div id="map_canvas" style="position: absolute !important;width: 100%; height: 100%"></div>
</body>
</html>